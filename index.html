<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®—æ•™å‹•æ…‹è²¼åœ–é¤¨ - ä½›å¿ƒå¸¸åœ¨Â·æ…ˆæ‚²åˆ†äº«</title>
    <meta name="description" content="ç²¾ç¾çš„å®—æ•™å‹•æ…‹GIFè²¼åœ–é¤¨ï¼ŒåŒ…å«å„ç¨®ä½›æ•™å’’èªå’Œä½›è™Ÿç³»åˆ—ï¼Œé€æ˜èƒŒæ™¯ï¼Œé©åˆç¤¾ç¾¤åª’é«”åˆ†äº«ã€‚">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-text {
            background: linear-gradient(to right, #d97706, #ea580c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .work-card {
            transition: all 0.3s ease;
        }
        .work-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.15);
        }
        .format-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .format-gif {
            background-color: #fef3c7;
            color: #92400e;
        }
        .format-webp {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .smart-badge {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
        }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #f59e0b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .github-sync {
            background: linear-gradient(135deg, #24292e, #586069);
            color: white;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-red-50">
    <!-- é ‚éƒ¨å°èˆª -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-amber-200">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center text-white text-xl font-bold">
                        ğŸ§˜
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold gradient-text">
                            å®—æ•™å‹•æ…‹è²¼åœ–é¤¨
                        </h1>
                        <p class="text-sm text-amber-600">ä½›å¿ƒå¸¸åœ¨Â·æ…ˆæ‚²åˆ†äº«</p>
                    </div>
                </div>
                <div class="px-3 py-1 bg-amber-100 text-amber-700 border border-amber-300 rounded-full text-sm">
                    âœ¨ æ™ºèƒ½å±•ç¤ºç‰ˆ
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å…§å®¹ -->
    <main class="container mx-auto px-4 py-8">
        <!-- åˆ†é¡å°èˆª -->
        <div class="flex flex-wrap justify-center gap-3 mb-8">
            <button onclick="filterWorks('all')" id="btn-all" class="category-btn active px-4 py-2 rounded-lg transition-all duration-300 bg-gradient-to-r from-amber-500 to-orange-500 text-white">
                <span class="mr-2">ğŸ­</span>
                å…¨éƒ¨ä½œå“
                <span class="ml-2 px-2 py-1 bg-white/20 rounded-full text-xs" id="count-all">0</span>
            </button>
            <button onclick="filterWorks('mantra')" id="btn-mantra" class="category-btn px-4 py-2 rounded-lg transition-all duration-300 bg-white/70 hover:bg-amber-50 border border-amber-200">
                <span class="mr-2">ğŸ“¿</span>
                å’’èªç³»åˆ—
                <span class="ml-2 px-2 py-1 bg-amber-100 text-amber-700 rounded-full text-xs" id="count-mantra">0</span>
            </button>
            <button onclick="filterWorks('buddha')" id="btn-buddha" class="category-btn px-4 py-2 rounded-lg transition-all duration-300 bg-white/70 hover:bg-amber-50 border border-amber-200">
                <span class="mr-2">ğŸ™</span>
                ä½›è™Ÿç³»åˆ—
                <span class="ml-2 px-2 py-1 bg-amber-100 text-amber-700 rounded-full text-xs" id="count-buddha">0</span>
            </button>
            <button onclick="filterWorks('coming')" id="btn-coming" class="category-btn px-4 py-2 rounded-lg transition-all duration-300 bg-white/70 hover:bg-amber-50 border border-amber-200">
                <span class="mr-2">âœ¨</span>
                å³å°‡æ¨å‡º
                <span class="ml-2 px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs">âˆ</span>
            </button>
        </div>

        <!-- ä½œå“å±•ç¤ºå€åŸŸ -->
        <section id="works-section" class="mb-12">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold gradient-text mb-2">
                    ç²¾é¸ä½œå“é›†
                </h2>
                <p class="text-amber-700">
                    æ¯å€‹ä½œå“éƒ½ç¶“éç²¾å¿ƒè¨­è¨ˆï¼Œä¿ç•™å®Œç¾ç´°ç¯€ï¼Œé©åˆç¤¾ç¾¤åª’é«”åˆ†äº«
                </p>
                
                <!-- GitHubåŒæ­¥ç‹€æ…‹ -->
                <div id="sync-status" class="mt-4 inline-flex items-center px-4 py-2 rounded-lg text-sm hidden">
                    <i class="fab fa-github mr-2"></i>
                    <span id="sync-text">æ­£åœ¨å¾GitHubè¼‰å…¥æœ€æ–°ä½œå“...</span>
                    <div class="loading-spinner ml-2"></div>
                </div>
            </div>

            <!-- è¼‰å…¥ç‹€æ…‹ -->
            <div id="loading-state" class="grid md:grid-cols-2 gap-8 max-w-6xl mx-auto">
                <!-- éª¨æ¶å±è¼‰å…¥å‹•ç•« -->
                <div class="work-card bg-white rounded-2xl p-6 shadow-lg">
                    <div class="skeleton h-48 rounded-xl mb-4"></div>
                    <div class="skeleton h-6 rounded mb-2"></div>
                    <div class="skeleton h-4 rounded w-3/4 mb-4"></div>
                    <div class="flex gap-2 mb-4">
                        <div class="skeleton h-6 w-16 rounded-full"></div>
                        <div class="skeleton h-6 w-20 rounded-full"></div>
                    </div>
                    <div class="skeleton h-10 rounded-lg"></div>
                </div>
                <div class="work-card bg-white rounded-2xl p-6 shadow-lg">
                    <div class="skeleton h-48 rounded-xl mb-4"></div>
                    <div class="skeleton h-6 rounded mb-2"></div>
                    <div class="skeleton h-4 rounded w-3/4 mb-4"></div>
                    <div class="flex gap-2 mb-4">
                        <div class="skeleton h-6 w-16 rounded-full"></div>
                        <div class="skeleton h-6 w-20 rounded-full"></div>
                    </div>
                    <div class="skeleton h-10 rounded-lg"></div>
                </div>
            </div>

            <!-- ä½œå“åˆ—è¡¨ -->
            <div id="works-container" class="grid md:grid-cols-2 gap-8 max-w-6xl mx-auto hidden">
                <!-- ä½œå“å°‡åœ¨é€™è£¡å‹•æ…‹è¼‰å…¥ -->
            </div>

            <!-- ç©ºç‹€æ…‹ -->
            <div id="empty-state" class="text-center py-12 hidden">
                <div class="text-6xl mb-4">ğŸ™</div>
                <h3 class="text-xl font-semibold text-amber-700 mb-2">æš«ç„¡ä½œå“</h3>
                <p class="text-amber-600 mb-4">è«‹ä½¿ç”¨å¾Œå°ç®¡ç†ç³»çµ±ä¸Šå‚³æ‚¨çš„å®—æ•™å‹•æ…‹è²¼åœ–ä½œå“</p>
                <a href="/admin.html" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg hover:from-amber-600 hover:to-orange-600 transition-colors">
                    <i class="fas fa-cog mr-2"></i>
                    é€²å…¥å¾Œå°ç®¡ç†
                </a>
            </div>

            <!-- éŒ¯èª¤ç‹€æ…‹ -->
            <div id="error-state" class="text-center py-12 hidden">
                <div class="text-6xl mb-4">âš ï¸</div>
                <h3 class="text-xl font-semibold text-red-700 mb-2">è¼‰å…¥å¤±æ•—</h3>
                <p class="text-red-600 mb-4" id="error-message">ç„¡æ³•è¼‰å…¥ä½œå“æ•¸æ“šï¼Œè«‹ç¨å¾Œé‡è©¦</p>
                <button onclick="loadWorks()" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-lg hover:from-red-600 hover:to-pink-600 transition-colors">
                    <i class="fas fa-redo mr-2"></i>
                    é‡æ–°è¼‰å…¥
                </button>
            </div>
        </section>

        <!-- å³å°‡æ¨å‡ºå€åŸŸ -->
        <section id="coming-section" class="mb-12 hidden">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">
                    å³å°‡æ¨å‡º âœ¨
                </h2>
                <p class="text-purple-700">
                    æ›´å¤šç²¾å½©çš„å®—æ•™å‹•æ…‹è²¼åœ–æ­£åœ¨å‰µä½œä¸­ï¼Œæ•¬è«‹æœŸå¾…ï¼
                </p>
            </div>
        </section>

        <!-- æ™ºèƒ½æŠ€è¡“ç‰¹è‰² -->
        <section class="mb-12">
            <div class="bg-gradient-to-r from-amber-100 to-orange-100 rounded-2xl p-8">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-amber-800 mb-2">
                        ğŸš€ æ™ºèƒ½æŠ€è¡“ç‰¹è‰²
                    </h2>
                    <p class="text-amber-700">æ¡ç”¨æœ€æ–°WebæŠ€è¡“ï¼Œæä¾›æ¥µè‡´ç”¨æˆ¶é«”é©—</p>
                </div>
                
                <div class="grid md:grid-cols-4 gap-6">
                    <div class="text-center space-y-2">
                        <div class="w-12 h-12 mx-auto bg-blue-200 rounded-full flex items-center justify-center text-blue-700 text-xl">
                            âš¡
                        </div>
                        <h3 class="font-semibold text-amber-800">é›™æ ¼å¼æ™ºèƒ½</h3>
                        <p class="text-sm text-amber-700">WebPåŠ é€Ÿè¼‰å…¥ï¼ŒGIFä¿ç•™é€æ˜æ•ˆæœ</p>
                    </div>
                    <div class="text-center space-y-2">
                        <div class="w-12 h-12 mx-auto bg-purple-200 rounded-full flex items-center justify-center text-purple-700 text-xl">
                            ğŸ¤–
                        </div>
                        <h3 class="font-semibold text-amber-800">AIæ™ºèƒ½æ¨™ç±¤</h3>
                        <p class="text-sm text-amber-700">æ™ºèƒ½åˆ†æå…§å®¹ï¼Œè‡ªå‹•æ¨è–¦ç›¸é—œæ¨™ç±¤</p>
                    </div>
                    <div class="text-center space-y-2">
                        <div class="w-12 h-12 mx-auto bg-amber-200 rounded-full flex items-center justify-center text-amber-700 text-xl">
                            ğŸ’
                        </div>
                        <h3 class="font-semibold text-amber-800">å®Œç¾é€æ˜èƒŒæ™¯</h3>
                        <p class="text-sm text-amber-700">å°ˆæ¥­ç´šé€æ˜è™•ç†ï¼Œé©åˆæ‰€æœ‰ç¤¾ç¾¤å¹³å°</p>
                    </div>
                    <div class="text-center space-y-2">
                        <div class="w-12 h-12 mx-auto bg-green-200 rounded-full flex items-center justify-center text-green-700 text-xl">
                            ğŸ“±
                        </div>
                        <h3 class="font-semibold text-amber-800">æ™ºèƒ½ä¸‹è¼‰</h3>
                        <p class="text-sm text-amber-700">æ ¹æ“šéœ€æ±‚é¸æ“‡æœ€é©åˆçš„æ ¼å¼ä¸‹è¼‰</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- é è…³ -->
    <footer class="bg-gradient-to-r from-amber-800 to-orange-800 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <div class="mb-4">
                <h3 class="text-xl font-bold mb-2">ğŸ™ å®—æ•™å‹•æ…‹è²¼åœ–é¤¨</h3>
                <p class="text-amber-100">å‚³æ’­æ…ˆæ‚²èˆ‡æ™ºæ…§ï¼Œåˆ†äº«æ­£èƒ½é‡</p>
            </div>
            <div class="text-sm text-amber-200">
                <p>Â© 2025 å®—æ•™å‹•æ…‹è²¼åœ–é¤¨ Â· é¡˜ä¸€åˆ‡çœ¾ç”Ÿé›¢è‹¦å¾—æ¨‚</p>
            </div>
        </div>
    </footer>

    <script>
        // å…¨å±€è®Šé‡
        let allWorks = [];
        let currentFilter = 'all';
        let isLoading = false;
        let githubConfig = null;

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadGitHubConfig();
            loadWorks();
        });

        // è¼‰å…¥GitHubé…ç½®
        function loadGitHubConfig() {
            try {
                const saved = localStorage.getItem('githubConfig');
                if (saved) {
                    githubConfig = JSON.parse(saved);
                }
            } catch (error) {
                console.error('è¼‰å…¥GitHubé…ç½®å¤±æ•—:', error);
            }
        }

        // è¼‰å…¥ä½œå“æ•¸æ“š
        async function loadWorks() {
            if (isLoading) return;
            isLoading = true;
            
            showLoadingState();
            
            try {
                // é¦–å…ˆå˜—è©¦å¾GitHubè¼‰å…¥
                const githubWorks = await loadWorksFromGitHub();
                
                if (githubWorks && githubWorks.length > 0) {
                    allWorks = githubWorks;
                    showSyncStatus('success', `å·²å¾GitHubè¼‰å…¥ ${githubWorks.length} å€‹ä½œå“`);
                } else {
                    // å›é€€åˆ°æœ¬åœ°å­˜å„²
                    const localWorks = loadWorksFromLocal();
                    allWorks = localWorks;
                    
                    if (localWorks.length > 0) {
                        showSyncStatus('warning', `å¾æœ¬åœ°è¼‰å…¥ ${localWorks.length} å€‹ä½œå“ï¼ˆGitHubåŒæ­¥å¤±æ•—ï¼‰`);
                    } else {
                        showSyncStatus('info', 'æš«ç„¡ä½œå“ï¼Œè«‹ä½¿ç”¨å¾Œå°ç®¡ç†ç³»çµ±ä¸Šå‚³');
                    }
                }
                
                updateCounts();
                renderWorks();
                
            } catch (error) {
                console.error('è¼‰å…¥ä½œå“å¤±æ•—:', error);
                showErrorState(error.message);
            } finally {
                isLoading = false;
                hideLoadingState();
            }
        }

        // å¾GitHubè¼‰å…¥ä½œå“æ•¸æ“š
        async function loadWorksFromGitHub() {
            if (!githubConfig || !githubConfig.repo) {
                return null;
            }

            try {
                showSyncStatus('loading', 'æ­£åœ¨å¾GitHubè¼‰å…¥æœ€æ–°ä½œå“...');
                
                const response = await fetch(`https://api.github.com/repos/${githubConfig.repo}/contents/works.json`, {
                    headers: {
                        'Accept': 'application/vnd.github.v3+json',
                        'Cache-Control': 'no-cache'
                    }
                });

                if (!response.ok) {
                    if (response.status === 404) {
                        console.log('works.json ä¸å­˜åœ¨ï¼Œé€™æ˜¯æ­£å¸¸çš„ï¼ˆå¦‚æœé‚„æ²’æœ‰ä¸Šå‚³ä½œå“ï¼‰');
                        return [];
                    }
                    throw new Error(`GitHub APIéŒ¯èª¤: ${response.status}`);
                }

                const data = await response.json();
                const content = atob(data.content);
                const worksData = JSON.parse(content);

                if (worksData.works && Array.isArray(worksData.works)) {
                    // é©—è­‰å’Œæ¸…ç†æ•¸æ“š
                    const validWorks = worksData.works.filter(work => 
                        work && 
                        typeof work === 'object' && 
                        work.id && 
                        work.title && 
                        (work.gifUrl || work.webpUrl)
                    );

                    // æ›´æ–°æœ¬åœ°ç·©å­˜
                    localStorage.setItem('uploadedWorks', JSON.stringify(validWorks));
                    localStorage.setItem('lastGitHubSync', new Date().toISOString());

                    return validWorks;
                }

                return [];
            } catch (error) {
                console.error('å¾GitHubè¼‰å…¥å¤±æ•—:', error);
                throw error;
            }
        }

        // å¾æœ¬åœ°å­˜å„²è¼‰å…¥ä½œå“æ•¸æ“š
        function loadWorksFromLocal() {
            try {
                const saved = localStorage.getItem('uploadedWorks');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (Array.isArray(parsed)) {
                        return parsed.filter(work => 
                            work && 
                            typeof work === 'object' && 
                            work.id && 
                            work.title && 
                            (work.image || work.gifUrl || work.webpUrl)
                        );
                    }
                }
                return [];
            } catch (error) {
                console.error('è¼‰å…¥æœ¬åœ°ä½œå“å¤±æ•—:', error);
                return [];
            }
        }

        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        function showLoadingState() {
            document.getElementById('loading-state').classList.remove('hidden');
            document.getElementById('works-container').classList.add('hidden');
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('error-state').classList.add('hidden');
        }

        // éš±è—è¼‰å…¥ç‹€æ…‹
        function hideLoadingState() {
            document.getElementById('loading-state').classList.add('hidden');
        }

        // é¡¯ç¤ºåŒæ­¥ç‹€æ…‹
        function showSyncStatus(type, message) {
            const syncStatus = document.getElementById('sync-status');
            const syncText = document.getElementById('sync-text');
            const spinner = syncStatus.querySelector('.loading-spinner');
            
            syncText.textContent = message;
            syncStatus.classList.remove('hidden');
            
            // ç§»é™¤æ‰€æœ‰ç‹€æ…‹é¡
            syncStatus.classList.remove('github-sync', 'bg-green-100', 'text-green-700', 'bg-yellow-100', 'text-yellow-700', 'bg-blue-100', 'text-blue-700');
            
            switch (type) {
                case 'loading':
                    syncStatus.classList.add('github-sync');
                    spinner.classList.remove('hidden');
                    break;
                case 'success':
                    syncStatus.classList.add('bg-green-100', 'text-green-700');
                    spinner.classList.add('hidden');
                    setTimeout(() => syncStatus.classList.add('hidden'), 3000);
                    break;
                case 'warning':
                    syncStatus.classList.add('bg-yellow-100', 'text-yellow-700');
                    spinner.classList.add('hidden');
                    setTimeout(() => syncStatus.classList.add('hidden'), 5000);
                    break;
                case 'info':
                    syncStatus.classList.add('bg-blue-100', 'text-blue-700');
                    spinner.classList.add('hidden');
                    setTimeout(() => syncStatus.classList.add('hidden'), 3000);
                    break;
            }
        }

        // é¡¯ç¤ºéŒ¯èª¤ç‹€æ…‹
        function showErrorState(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-state').classList.remove('hidden');
            document.getElementById('works-container').classList.add('hidden');
            document.getElementById('empty-state').classList.add('hidden');
        }

        // æ›´æ–°åˆ†é¡è¨ˆæ•¸
        function updateCounts() {
            const mantraCount = allWorks.filter(w => w.category === 'mantra').length;
            const buddhaCount = allWorks.filter(w => w.category === 'buddha').length;
            
            document.getElementById('count-all').textContent = allWorks.length;
            document.getElementById('count-mantra').textContent = mantraCount;
            document.getElementById('count-buddha').textContent = buddhaCount;
        }

        // ç¯©é¸ä½œå“
        function filterWorks(category) {
            currentFilter = category;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-gradient-to-r', 'from-amber-500', 'to-orange-500', 'text-white');
                btn.classList.add('bg-white/70', 'hover:bg-amber-50', 'border', 'border-amber-200');
            });
            
            const activeBtn = document.getElementById(`btn-${category}`);
            activeBtn.classList.add('active', 'bg-gradient-to-r', 'from-amber-500', 'to-orange-500', 'text-white');
            activeBtn.classList.remove('bg-white/70', 'hover:bg-amber-50', 'border', 'border-amber-200');
            
            // é¡¯ç¤º/éš±è—ç›¸æ‡‰å€åŸŸ
            if (category === 'coming') {
                document.getElementById('works-section').classList.add('hidden');
                document.getElementById('coming-section').classList.remove('hidden');
            } else {
                document.getElementById('works-section').classList.remove('hidden');
                document.getElementById('coming-section').classList.add('hidden');
                renderWorks();
            }
        }

        // æ¸²æŸ“ä½œå“
        function renderWorks() {
            const container = document.getElementById('works-container');
            const emptyState = document.getElementById('empty-state');
            const errorState = document.getElementById('error-state');
            
            let filteredWorks = allWorks;
            if (currentFilter !== 'all') {
                filteredWorks = allWorks.filter(work => work.category === currentFilter);
            }
            
            // éš±è—éŒ¯èª¤ç‹€æ…‹
            errorState.classList.add('hidden');
            
            if (filteredWorks.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            container.classList.remove('hidden');
            
            container.innerHTML = filteredWorks.map(work => createWorkCard(work)).join('');
            
            // æ·»åŠ æ·¡å…¥å‹•ç•«
            container.querySelectorAll('.work-card').forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
                card.classList.add('fade-in');
            });
        }

        // å‰µå»ºä½œå“å¡ç‰‡
        function createWorkCard(work) {
            const imageUrl = work.gifUrl || work.webpUrl || work.image;
            const hasWebP = work.webpUrl && work.gifUrl;
            const tags = work.tags || [];
            const uploadDate = work.uploadDate ? new Date(work.uploadDate).toLocaleDateString('zh-TW') : '';
            
            return `
                <div class="work-card bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300">
                    <div class="relative mb-4">
                        <img src="${imageUrl}" alt="${work.title}" class="w-full h-48 object-contain rounded-xl bg-gray-50">
                        
                        <!-- æ ¼å¼æ¨™ç±¤ -->
                        <div class="absolute top-2 right-2 flex gap-1">
                            ${work.gifUrl ? '<span class="format-badge format-gif">GIF</span>' : ''}
                            ${work.webpUrl ? '<span class="format-badge format-webp">WebP</span>' : ''}
                            ${work.source === 'github' ? '<span class="format-badge github-sync"><i class="fab fa-github mr-1"></i>GitHub</span>' : ''}
                        </div>
                        
                        <!-- æ™ºèƒ½æ¨™ç±¤ -->
                        ${hasWebP ? '<div class="absolute top-2 left-2"><span class="format-badge smart-badge"><i class="fas fa-magic mr-1"></i>æ™ºèƒ½</span></div>' : ''}
                    </div>
                    
                    <div class="space-y-3">
                        <div>
                            <h3 class="text-lg font-bold text-gray-800 mb-1">${work.title}</h3>
                            ${work.subtitle ? `<p class="text-sm text-gray-600">${work.subtitle}</p>` : ''}
                        </div>
                        
                        ${work.description ? `<p class="text-gray-600 text-sm line-clamp-2">${work.description}</p>` : ''}
                        
                        <!-- æ¨™ç±¤ -->
                        ${tags.length > 0 ? `
                            <div class="flex flex-wrap gap-1">
                                ${tags.slice(0, 3).map(tag => `<span class="px-2 py-1 bg-amber-100 text-amber-700 text-xs rounded-full">${tag}</span>`).join('')}
                                ${tags.length > 3 ? `<span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">+${tags.length - 3}</span>` : ''}
                            </div>
                        ` : ''}
                        
                        <!-- ä¸‹è¼‰æŒ‰éˆ• -->
                        <div class="flex gap-2">
                            ${work.gifUrl ? `
                                <button onclick="downloadImage('${work.gifUrl}', '${work.title}.gif')" class="flex-1 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg hover:from-amber-600 hover:to-orange-600 transition-colors text-sm">
                                    <i class="fas fa-download mr-1"></i>
                                    ä¸‹è¼‰ GIF
                                </button>
                            ` : ''}
                            ${work.webpUrl ? `
                                <button onclick="downloadImage('${work.webpUrl}', '${work.title}.webp')" class="flex-1 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg hover:from-blue-600 hover:to-purple-600 transition-colors text-sm">
                                    <i class="fas fa-download mr-1"></i>
                                    ä¸‹è¼‰ WebP
                                </button>
                            ` : ''}
                            ${!work.gifUrl && !work.webpUrl && work.image ? `
                                <button onclick="downloadImage('${work.image}', '${work.title}')" class="flex-1 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg hover:from-amber-600 hover:to-orange-600 transition-colors text-sm">
                                    <i class="fas fa-download mr-1"></i>
                                    ä¸‹è¼‰åœ–ç‰‡
                                </button>
                            ` : ''}
                        </div>
                        
                        <!-- ä¸Šå‚³æ—¥æœŸ -->
                        ${uploadDate ? `<div class="text-xs text-gray-500 text-center">ä¸Šå‚³æ–¼ ${uploadDate}</div>` : ''}
                    </div>
                </div>
            `;
        }

        // ä¸‹è¼‰åœ–ç‰‡
        function downloadImage(url, filename) {
            try {
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                console.error('ä¸‹è¼‰å¤±æ•—:', error);
                // å¦‚æœä¸‹è¼‰å¤±æ•—ï¼Œå˜—è©¦åœ¨æ–°çª—å£æ‰“é–‹
                window.open(url, '_blank');
            }
        }

        // æ‰‹å‹•é‡æ–°è¼‰å…¥
        function reloadWorks() {
            allWorks = [];
            loadWorks();
        }

        // å®šæœŸåŒæ­¥ï¼ˆæ¯5åˆ†é˜æª¢æŸ¥ä¸€æ¬¡ï¼‰
        setInterval(() => {
            if (!isLoading && githubConfig && githubConfig.repo) {
                loadWorksFromGitHub().then(works => {
                    if (works && works.length !== allWorks.length) {
                        allWorks = works;
                        updateCounts();
                        renderWorks();
                        showSyncStatus('success', 'å·²è‡ªå‹•åŒæ­¥æœ€æ–°ä½œå“');
                    }
                }).catch(error => {
                    console.log('è‡ªå‹•åŒæ­¥å¤±æ•—:', error);
                });
            }
        }, 5 * 60 * 1000); // 5åˆ†é˜
    </script>
</body>
</html>
