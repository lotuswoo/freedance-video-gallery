<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®—æ•™å‹•æ…‹è²¼åœ–é¤¨ - GitHubæ•´åˆå¾Œå°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #f59e0b;
            background-color: #fef3c7;
        }
        .upload-area.dragover {
            border-color: #f59e0b;
            background-color: #fef3c7;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-20px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.success { background-color: #10b981; }
        .toast.error { background-color: #ef4444; }
        .toast.warning { background-color: #f59e0b; }
        .work-card {
            transition: all 0.3s ease;
        }
        .work-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .work-card.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .search-highlight {
            background-color: #fef3c7;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .format-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .format-gif {
            background-color: #fef3c7;
            color: #92400e;
        }
        .format-webp {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .ai-tag-suggestion {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 2px;
        }
        .ai-tag-suggestion:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .ai-processing {
            background: linear-gradient(45deg, #667eea, #764ba2);
            background-size: 200% 200%;
            animation: gradientShift 2s ease infinite;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .dual-format-preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 16px 0;
        }
        .format-preview {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        .format-preview.active {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .github-status {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .github-connected {
            background-color: #dcfce7;
            color: #166534;
        }
        .github-disconnected {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .sync-animation {
            animation: spin 1s linear infinite;
        }
        .github-config {
            background: linear-gradient(135deg, #24292e 0%, #586069 100%);
            color: white;
            border-radius: 8px;
            padding: 16px;
        }
        .deploy-status {
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
        }
        .deploy-success {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        .deploy-pending {
            background-color: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        .deploy-error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 to-orange-50 min-h-screen">
    <!-- é ‚éƒ¨å°èˆª -->
    <nav class="bg-white shadow-sm border-b border-amber-200 sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center text-white text-lg font-bold">
                        ğŸ™
                    </div>
                    <div>
                        <h1 class="text-xl font-bold bg-gradient-to-r from-amber-600 to-orange-600 bg-clip-text text-transparent">
                            å®—æ•™å‹•æ…‹è²¼åœ–é¤¨
                        </h1>
                        <p class="text-sm text-amber-600">GitHubæ•´åˆå¾Œå° <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full ml-2">é›²ç«¯åŒæ­¥</span></p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-500">
                        <span>ç¸½ä½œå“: <span id="totalCount" class="font-semibold text-amber-600">0</span></span>
                        <span class="mx-2">|</span>
                        <span>é›™æ ¼å¼: <span id="dualFormatCount" class="font-semibold text-blue-600">0</span></span>
                        <span class="mx-2">|</span>
                        <span id="githubStatus" class="github-status github-disconnected">
                            <i class="fab fa-github mr-1"></i>
                            æœªé€£æ¥
                        </span>
                    </div>
                    <a href="/" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-colors text-sm">
                        <i class="fas fa-home mr-2"></i>
                        è¿”å›ä¸»ç¶²ç«™
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <!-- å¿«é€Ÿæ“ä½œé¢æ¿ -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center space-x-4">
                    <button onclick="showUploadModal()" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg hover:from-amber-600 hover:to-orange-600 transition-colors">
                        <i class="fab fa-github mr-2"></i>
                        ä¸Šå‚³åˆ°GitHub
                    </button>
                    <button onclick="toggleBatchMode()" id="batchModeBtn" class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-check-square mr-2"></i>
                        æ‰¹é‡æ“ä½œ
                    </button>
                    <div id="batchActions" class="hidden flex items-center space-x-2">
                        <button onclick="batchDownload()" class="px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors text-sm">
                            <i class="fas fa-download mr-1"></i>
                            æ‰¹é‡ä¸‹è¼‰
                        </button>
                        <button onclick="batchOptimize()" class="px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-sm">
                            <i class="fas fa-magic mr-1"></i>
                            æ‰¹é‡å„ªåŒ–
                        </button>
                        <button onclick="batchDelete()" class="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors text-sm">
                            <i class="fas fa-trash mr-1"></i>
                            æ‰¹é‡åˆªé™¤
                        </button>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="showGitHubConfigModal()" class="inline-flex items-center px-3 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors text-sm">
                        <i class="fab fa-github mr-2"></i>
                        GitHubè¨­ç½®
                    </button>
                    <button onclick="exportData()" class="inline-flex items-center px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                        <i class="fas fa-download mr-2"></i>
                        åŒ¯å‡ºæ•¸æ“š
                    </button>
                    <button onclick="importData()" class="inline-flex items-center px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                        <i class="fas fa-upload mr-2"></i>
                        åŒ¯å…¥æ•¸æ“š
                    </button>
                </div>
            </div>
        </div>

        <!-- æœç´¢å’Œç¯©é¸ -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <div class="grid md:grid-cols-5 gap-4">
                <div class="md:col-span-2">
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="æœç´¢ä½œå“æ¨™é¡Œã€æè¿°æˆ–æ¨™ç±¤..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                <div>
                    <select id="categoryFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                        <option value="">æ‰€æœ‰åˆ†é¡</option>
                        <option value="mantra">å’’èªç³»åˆ—</option>
                        <option value="buddha">ä½›è™Ÿç³»åˆ—</option>
                    </select>
                </div>
                <div>
                    <select id="formatFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                        <option value="">æ‰€æœ‰æ ¼å¼</option>
                        <option value="dual">é›™æ ¼å¼</option>
                        <option value="gif-only">åƒ…GIF</option>
                    </select>
                </div>
                <div>
                    <select id="sortBy" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                        <option value="newest">æœ€æ–°ä¸Šå‚³</option>
                        <option value="oldest">æœ€æ—©ä¸Šå‚³</option>
                        <option value="title">æ¨™é¡Œæ’åº</option>
                        <option value="size">æª”æ¡ˆå¤§å°</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ä½œå“åˆ—è¡¨ -->
        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-semibold text-gray-800">æ™ºèƒ½ä½œå“ç®¡ç†</h3>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-500">é¡¯ç¤º <span id="displayCount">0</span> å€‹ä½œå“</span>
                    <div class="flex items-center space-x-2">
                        <button onclick="changeView('grid')" id="gridViewBtn" class="p-2 text-gray-500 hover:text-amber-600 transition-colors">
                            <i class="fas fa-th-large"></i>
                        </button>
                        <button onclick="changeView('list')" id="listViewBtn" class="p-2 text-amber-600 hover:text-amber-700 transition-colors">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="worksContainer" class="space-y-4">
                <!-- ä½œå“åˆ—è¡¨å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
            </div>

            <!-- åˆ†é  -->
            <div id="pagination" class="flex items-center justify-center space-x-2 mt-8 hidden">
                <button onclick="changePage('prev')" id="prevBtn" class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div id="pageNumbers" class="flex space-x-1"></div>
                <button onclick="changePage('next')" id="nextBtn" class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- ä¸Šå‚³æ¨¡æ…‹çª—å£ -->
    <div id="uploadModal" class="modal">
        <div class="modal-content p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-gray-800">
                    <i class="fab fa-github mr-2 text-gray-800"></i>
                    ä¸Šå‚³åˆ°GitHub
                </h3>
                <button onclick="closeUploadModal()" class="text-gray-500 hover:text-gray-700 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- GitHubé€£æ¥ç‹€æ…‹ -->
            <div id="githubConnectionStatus" class="mb-6">
                <div class="github-config">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-semibold flex items-center">
                            <i class="fab fa-github mr-2"></i>
                            GitHubé€£æ¥ç‹€æ…‹
                        </h4>
                        <span id="connectionStatus" class="github-status github-disconnected">
                            <i class="fas fa-times-circle mr-1"></i>
                            æœªé€£æ¥
                        </span>
                    </div>
                    <div id="connectionMessage" class="text-sm text-gray-300">
                        è«‹å…ˆåœ¨GitHubè¨­ç½®ä¸­é…ç½®æ‚¨çš„Repositoryå’ŒAccess Token
                    </div>
                </div>
            </div>

            <form id="uploadForm" class="space-y-6">
                <!-- æ–‡ä»¶ä¸Šå‚³å€åŸŸ -->
                <div id="uploadArea" class="upload-area rounded-lg p-8 text-center">
                    <div class="text-6xl text-amber-500 mb-4">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <p class="text-lg text-gray-600 mb-2">é»æ“Šé¸æ“‡GIFæ–‡ä»¶æˆ–æ‹–æ‹½åˆ°æ­¤è™•</p>
                    <p class="text-sm text-gray-500">æ”¯æ´é€æ˜èƒŒæ™¯çš„GIFæ ¼å¼ï¼Œå°‡è‡ªå‹•ç”ŸæˆWebPç‰ˆæœ¬</p>
                    <input type="file" id="fileInput" accept=".gif" class="hidden">
                </div>

                <!-- é›™æ ¼å¼é è¦½ -->
                <div id="formatPreview" class="hidden">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">
                        <i class="fas fa-eye mr-1"></i>
                        æ ¼å¼é è¦½
                    </h4>
                    <div class="dual-format-preview">
                        <div class="format-preview">
                            <div class="format-badge format-gif mb-2">GIF åŸæª”</div>
                            <img id="gifPreview" class="w-full h-32 object-cover rounded mb-2">
                            <p class="text-xs text-gray-500">ä¿ç•™é€æ˜æ•ˆæœï¼Œç”¨æ–¼ä¸‹è¼‰</p>
                        </div>
                        <div class="format-preview">
                            <div class="format-badge format-webp mb-2">WebP å±•ç¤º</div>
                            <img id="webpPreview" class="w-full h-32 object-cover rounded mb-2">
                            <p class="text-xs text-gray-500">åŠ é€Ÿè¼‰å…¥ï¼Œç¶²é å±•ç¤º</p>
                        </div>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-tag mr-1"></i>
                            ä½œå“æ¨™é¡Œ *
                        </label>
                        <input type="text" id="title" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="ä¾‹ï¼šè§€éŸ³å¿ƒå’’">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-heading mr-1"></i>
                            å‰¯æ¨™é¡Œ
                        </label>
                        <input type="text" id="subtitle" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="ä¾‹ï¼šæ…ˆæ‚²è§€éŸ³å¿ƒå’’ - å…­å­—å¤§æ˜å’’">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-align-left mr-1"></i>
                        ä½œå“æè¿°
                    </label>
                    <textarea id="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="æè¿°é€™å€‹ä½œå“çš„ç‰¹è‰²å’Œç”¨é€”..."></textarea>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-folder mr-1"></i>
                            åˆ†é¡
                        </label>
                        <select id="category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                            <option value="mantra">å’’èªç³»åˆ—</option>
                            <option value="buddha">ä½›è™Ÿç³»åˆ—</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-robot mr-1 text-purple-600"></i>
                            AIæ™ºèƒ½æ¨™ç±¤
                        </label>
                        <div class="relative">
                            <input type="text" id="tags" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="AIæ­£åœ¨åˆ†æ...">
                            <button type="button" id="aiAnalyzeBtn" onclick="analyzeImageWithAI()" class="absolute right-2 top-2 px-2 py-1 bg-purple-500 text-white text-xs rounded hover:bg-purple-600 transition-colors">
                                <i class="fas fa-magic mr-1"></i>AIåˆ†æ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- AIæ¨™ç±¤å»ºè­°å€åŸŸ -->
                <div id="aiSuggestions" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-lightbulb mr-1 text-purple-600"></i>
                        AIå»ºè­°æ¨™ç±¤ (é»æ“Šæ·»åŠ )
                    </label>
                    <div id="suggestedTags" class="flex flex-wrap gap-2 p-3 bg-purple-50 rounded-lg border border-purple-200">
                        <!-- AIå»ºè­°çš„æ¨™ç±¤å°‡åœ¨é€™è£¡é¡¯ç¤º -->
                    </div>
                </div>

                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="closeUploadModal()" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-times mr-2"></i>
                        å–æ¶ˆ
                    </button>
                    <button type="submit" id="uploadBtn" class="flex-1 px-4 py-2 bg-gradient-to-r from-gray-700 to-gray-900 text-white rounded-lg hover:from-gray-800 hover:to-black transition-colors">
                        <i class="fab fa-github mr-2"></i>
                        ä¸Šå‚³åˆ°GitHub
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç·¨è¼¯æ¨¡æ…‹çª—å£ -->
    <div id="editModal" class="modal">
        <div class="modal-content p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-gray-800">
                    <i class="fas fa-edit mr-2 text-blue-500"></i>
                    ç·¨è¼¯ä½œå“
                </h3>
                <button onclick="closeEditModal()" class="text-gray-500 hover:text-gray-700 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="editForm" class="space-y-6">
                <input type="hidden" id="editWorkId">
                
                <!-- ç•¶å‰åœ–ç‰‡é è¦½ -->
                <div class="text-center mb-4">
                    <img id="editImagePreview" class="w-32 h-32 object-cover rounded-lg border mx-auto mb-2 shadow-sm">
                    <p class="text-sm text-gray-500">ç•¶å‰åœ–ç‰‡</p>
                </div>
                
                <!-- å¯é¸ï¼šæ›´æ›åœ–ç‰‡ -->
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-amber-400 transition-colors">
                    <i class="fas fa-image text-2xl text-gray-400 mb-2"></i>
                    <p class="text-sm text-gray-600 mb-2">å¦‚éœ€æ›´æ›åœ–ç‰‡ï¼Œè«‹é¸æ“‡æ–°çš„GIFæ–‡ä»¶</p>
                    <input type="file" id="editFileInput" accept=".gif" class="text-sm">
                    <p class="text-xs text-gray-500 mt-1">ç•™ç©ºå‰‡ä¿æŒåŸåœ–ç‰‡ä¸è®Š</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-tag mr-1"></i>
                            ä½œå“æ¨™é¡Œ *
                        </label>
                        <input type="text" id="editTitle" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-heading mr-1"></i>
                            å‰¯æ¨™é¡Œ
                        </label>
                        <input type="text" id="editSubtitle" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-align-left mr-1"></i>
                        ä½œå“æè¿°
                    </label>
                    <textarea id="editDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"></textarea>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-folder mr-1"></i>
                            åˆ†é¡
                        </label>
                        <select id="editCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                            <option value="mantra">å’’èªç³»åˆ—</option>
                            <option value="buddha">ä½›è™Ÿç³»åˆ—</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-tags mr-1"></i>
                            æ¨™ç±¤ (ç”¨é€—è™Ÿåˆ†éš”)
                        </label>
                        <input type="text" id="editTags" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                    </div>
                </div>

                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="closeEditModal()" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-times mr-2"></i>
                        å–æ¶ˆ
                    </button>
                    <button type="submit" id="editBtn" class="flex-1 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg hover:from-blue-600 hover:to-purple-600 transition-colors">
                        <i class="fas fa-save mr-2"></i>
                        ä¿å­˜ä¿®æ”¹
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç¢ºèªå°è©±æ¡† -->
    <div id="confirmModal" class="modal">
        <div class="modal-content p-8 max-w-md">
            <div class="text-center">
                <div class="text-6xl mb-4" id="confirmIcon">âš ï¸</div>
                <h3 class="text-xl font-semibold text-gray-800 mb-4" id="confirmTitle">ç¢ºèªæ“ä½œ</h3>
                <p class="text-gray-600 mb-6" id="confirmMessage">æ‚¨ç¢ºå®šè¦åŸ·è¡Œæ­¤æ“ä½œå—ï¼Ÿ</p>
                <div class="flex gap-4">
                    <button onclick="closeConfirmModal()" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        å–æ¶ˆ
                    </button>
                    <button id="confirmBtn" class="flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                        ç¢ºèª
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- GitHubé…ç½®æ¨¡æ…‹çª—å£ -->
    <div id="githubConfigModal" class="modal">
        <div class="modal-content p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-gray-800">
                    <i class="fab fa-github mr-2 text-gray-800"></i>
                    GitHubè¨­ç½®
                </h3>
                <button onclick="closeGitHubConfigModal()" class="text-gray-500 hover:text-gray-700 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <form id="githubConfigForm" class="space-y-6">
                <!-- Repositoryè¨­ç½® -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fab fa-github mr-1"></i>
                        GitHub Repository
                    </label>
                    <input type="text" id="githubRepo" placeholder="username/repository-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500">
                    <p class="text-xs text-gray-500 mt-1">ä¾‹å¦‚: john/my-sticker-gallery</p>
                </div>

                <!-- Access Tokenè¨­ç½® -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-key mr-1"></i>
                        Personal Access Token
                    </label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500">
                    <p class="text-xs text-gray-500 mt-1">éœ€è¦ repo æ¬Šé™çš„ GitHub Personal Access Token</p>
                </div>

                <!-- åˆ†æ”¯è¨­ç½® -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-code-branch mr-1"></i>
                        ç›®æ¨™åˆ†æ”¯
                    </label>
                    <input type="text" id="githubBranch" value="main" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500">
                    <p class="text-xs text-gray-500 mt-1">é€šå¸¸æ˜¯ main æˆ– master</p>
                </div>

                <!-- é€£æ¥æ¸¬è©¦ -->
                <div id="connectionTest" class="hidden">
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">é€£æ¥æ¸¬è©¦</span>
                            <div id="testStatus" class="text-sm"></div>
                        </div>
                        <div id="testMessage" class="text-xs text-gray-600"></div>
                    </div>
                </div>

                <!-- è¨­ç½®æŒ‡å— -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-semibold text-blue-800 mb-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        è¨­ç½®æŒ‡å—
                    </h4>
                    <ol class="text-sm text-blue-700 space-y-1">
                        <li>1. åœ¨GitHubå‰µå»ºä¸€å€‹æ–°çš„Repository</li>
                        <li>2. ç”ŸæˆPersonal Access Token (Settings â†’ Developer settings â†’ Personal access tokens)</li>
                        <li>3. ç¢ºä¿Tokenæœ‰ repo æ¬Šé™</li>
                        <li>4. å¡«å…¥ä¸Šè¿°ä¿¡æ¯ä¸¦æ¸¬è©¦é€£æ¥</li>
                        <li>5. é€£æ¥æˆåŠŸå¾Œå³å¯é–‹å§‹ä¸Šå‚³è²¼åœ–</li>
                    </ol>
                </div>

                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="testGitHubConnection()" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-plug mr-2"></i>
                        æ¸¬è©¦é€£æ¥
                    </button>
                    <button type="submit" class="flex-1 px-4 py-2 bg-gradient-to-r from-gray-700 to-gray-900 text-white rounded-lg hover:from-gray-800 hover:to-black transition-colors">
                        <i class="fas fa-save mr-2"></i>
                        ä¿å­˜è¨­ç½®
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- éš±è—çš„æ–‡ä»¶è¼¸å…¥ç”¨æ–¼åŒ¯å…¥ -->
    <input type="file" id="importFileInput" accept=".json" class="hidden">

    <script>
        // å…¨å±€è®Šé‡
        let allWorks = [];
        let filteredWorks = [];
        let selectedWorks = new Set();
        let currentPage = 1;
        let itemsPerPage = 10;
        let viewMode = 'list';
        let batchMode = false;
        let selectedFile = null;
        
        // GitHubç›¸é—œè®Šé‡
        let githubConfig = {
            repo: '',
            token: '',
            branch: 'main'
        };
        let isGitHubConnected = false;

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadGitHubConfig();
            loadUploadedWorks();
            setupEventListeners();
            updateStats();
            updateGitHubStatus();
        });

        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            // æœç´¢å’Œç¯©é¸
            document.getElementById('searchInput').addEventListener('input', debounce(filterWorks, 300));
            document.getElementById('categoryFilter').addEventListener('change', filterWorks);
            document.getElementById('sortBy').addEventListener('change', filterWorks);

            // æ–‡ä»¶ä¸Šå‚³
            setupFileUpload();

            // éµç›¤å¿«æ·éµ
            document.addEventListener('keydown', handleKeyboardShortcuts);

            // åŒ¯å…¥æ–‡ä»¶
            document.getElementById('importFileInput').addEventListener('change', handleImportFile);
        }

        // é˜²æŠ–å‡½æ•¸
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // è¼‰å…¥å·²ä¸Šå‚³çš„ä½œå“
        function loadUploadedWorks() {
            try {
                allWorks = JSON.parse(localStorage.getItem('uploadedWorks') || '[]');
                filteredWorks = [...allWorks];
                renderWorks();
                updateStats();
            } catch (error) {
                console.error('è¼‰å…¥ä½œå“å¤±æ•—:', error);
                showToast('è¼‰å…¥ä½œå“å¤±æ•—', 'error');
            }
        }

        // æ¸²æŸ“ä½œå“åˆ—è¡¨
        function renderWorks() {
            const container = document.getElementById('worksContainer');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const worksToShow = filteredWorks.slice(startIndex, endIndex);

            if (worksToShow.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <div class="text-6xl mb-4">ğŸ“­</div>
                        <h3 class="text-xl font-semibold mb-2">æš«ç„¡ä½œå“</h3>
                        <p class="text-gray-400">
                            ${filteredWorks.length === 0 && allWorks.length > 0 ? 'æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„ä½œå“' : 'ä¸Šå‚³ç¬¬ä¸€å€‹ä½œå“å¾Œå°‡åœ¨æ­¤é¡¯ç¤º'}
                        </p>
                    </div>
                `;
                return;
            }

            container.innerHTML = worksToShow.map(work => `
                <div class="work-card border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all ${selectedWorks.has(work.id) ? 'selected' : ''}">
                    <div class="flex items-start gap-4">
                        ${batchMode ? `
                            <div class="flex-shrink-0 pt-2">
                                <input type="checkbox" ${selectedWorks.has(work.id) ? 'checked' : ''} 
                                       onchange="toggleWorkSelection('${work.id}')"
                                       class="w-4 h-4 text-amber-600 border-gray-300 rounded focus:ring-amber-500">
                            </div>
                        ` : ''}
                        <div class="flex-shrink-0">
                            <img src="${work.image}" alt="${work.title}" 
                                 class="w-20 h-20 object-cover rounded-lg border shadow-sm cursor-pointer"
                                 onclick="previewImage('${work.image}', '${work.title}')">
                        </div>
                        <div class="flex-grow">
                            <h4 class="font-semibold text-gray-800 text-lg">${highlightSearchTerm(work.title)}</h4>
                            ${work.subtitle ? `<p class="text-sm text-gray-600 mb-1">${highlightSearchTerm(work.subtitle)}</p>` : ''}
                            ${work.description ? `<p class="text-sm text-gray-500 mb-2">${highlightSearchTerm(work.description)}</p>` : ''}
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="px-2 py-1 bg-amber-100 text-amber-700 text-xs rounded-full">
                                    <i class="fas fa-folder mr-1"></i>
                                    ${work.category === 'mantra' ? 'å’’èªç³»åˆ—' : 'ä½›è™Ÿç³»åˆ—'}
                                </span>
                                <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">
                                    <i class="fas fa-file-image mr-1"></i>
                                    ${work.size}
                                </span>
                                ${work.tags.map(tag => `
                                    <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">
                                        <i class="fas fa-tag mr-1"></i>
                                        ${highlightSearchTerm(tag)}
                                    </span>
                                `).join('')}
                            </div>
                            <div class="flex items-center justify-between">
                                <p class="text-xs text-gray-400">
                                    <i class="fas fa-clock mr-1"></i>
                                    ${new Date(parseInt(work.id.split('-')[1])).toLocaleString()}
                                </p>
                                <div class="flex items-center space-x-2">
                                    <button onclick="editWork('${work.id}')" 
                                            class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors"
                                            title="ç·¨è¼¯ä½œå“">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="downloadWork('${work.id}')" 
                                            class="px-3 py-1 bg-green-500 text-white text-sm rounded hover:bg-green-600 transition-colors"
                                            title="ä¸‹è¼‰ä½œå“">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button onclick="confirmDelete('${work.id}')" 
                                            class="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition-colors"
                                            title="åˆªé™¤ä½œå“">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            updatePagination();
            updateDisplayCount();
        }

        // é«˜äº®æœç´¢è©
        function highlightSearchTerm(text) {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        // ç¯©é¸ä½œå“
        function filterWorks() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const sortBy = document.getElementById('sortBy').value;

            filteredWorks = allWorks.filter(work => {
                const matchesSearch = !searchTerm || 
                    work.title.toLowerCase().includes(searchTerm) ||
                    work.subtitle?.toLowerCase().includes(searchTerm) ||
                    work.description?.toLowerCase().includes(searchTerm) ||
                    work.tags.some(tag => tag.toLowerCase().includes(searchTerm));

                const matchesCategory = !categoryFilter || work.category === categoryFilter;

                return matchesSearch && matchesCategory;
            });

            // æ’åº
            filteredWorks.sort((a, b) => {
                switch (sortBy) {
                    case 'newest':
                        return parseInt(b.id.split('-')[1]) - parseInt(a.id.split('-')[1]);
                    case 'oldest':
                        return parseInt(a.id.split('-')[1]) - parseInt(b.id.split('-')[1]);
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'size':
                        return parseFloat(b.size) - parseFloat(a.size);
                    default:
                        return 0;
                }
            });

            currentPage = 1;
            renderWorks();
        }

        // æ›´æ–°çµ±è¨ˆä¿¡æ¯
        function updateStats() {
            document.getElementById('totalCount').textContent = allWorks.length;
        }

        // æ›´æ–°é¡¯ç¤ºæ•¸é‡
        function updateDisplayCount() {
            document.getElementById('displayCount').textContent = filteredWorks.length;
        }

        // æ›´æ–°åˆ†é 
        function updatePagination() {
            const totalPages = Math.ceil(filteredWorks.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.classList.add('hidden');
                return;
            }

            pagination.classList.remove('hidden');
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;

            // ç”Ÿæˆé ç¢¼
            const pageNumbers = document.getElementById('pageNumbers');
            pageNumbers.innerHTML = '';
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    const btn = document.createElement('button');
                    btn.textContent = i;
                    btn.className = `px-3 py-2 border rounded-lg transition-colors ${
                        i === currentPage 
                            ? 'bg-amber-500 text-white border-amber-500' 
                            : 'border-gray-300 hover:bg-gray-50'
                    }`;
                    btn.onclick = () => changePage(i);
                    pageNumbers.appendChild(btn);
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    const span = document.createElement('span');
                    span.textContent = '...';
                    span.className = 'px-2 py-2 text-gray-500';
                    pageNumbers.appendChild(span);
                }
            }
        }

        // åˆ‡æ›é é¢
        function changePage(page) {
            if (page === 'prev') {
                currentPage = Math.max(1, currentPage - 1);
            } else if (page === 'next') {
                const totalPages = Math.ceil(filteredWorks.length / itemsPerPage);
                currentPage = Math.min(totalPages, currentPage + 1);
            } else {
                currentPage = page;
            }
            renderWorks();
        }

        // é¡¯ç¤ºä¸Šå‚³æ¨¡æ…‹çª—å£
        function showUploadModal() {
            document.getElementById('uploadModal').classList.add('show');
            resetUploadForm();
        }

        // é—œé–‰ä¸Šå‚³æ¨¡æ…‹çª—å£
        function closeUploadModal() {
            document.getElementById('uploadModal').classList.remove('show');
        }

        // é‡ç½®ä¸Šå‚³è¡¨å–®
        function resetUploadForm() {
            document.getElementById('uploadForm').reset();
            selectedFile = null;
            resetUploadArea();
        }

        // é‡ç½®ä¸Šå‚³å€åŸŸ
        function resetUploadArea() {
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.innerHTML = `
                <div class="text-6xl text-amber-500 mb-4">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <p class="text-lg text-gray-600 mb-2">é»æ“Šé¸æ“‡GIFæ–‡ä»¶æˆ–æ‹–æ‹½åˆ°æ­¤è™•</p>
                <p class="text-sm text-gray-500">æ”¯æ´é€æ˜èƒŒæ™¯çš„GIFæ ¼å¼ï¼Œæœ€å¤§10MB</p>
            `;
            uploadArea.classList.remove('border-green-400', 'bg-green-50');
        }

        // è¨­ç½®æ–‡ä»¶ä¸Šå‚³
        function setupFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            uploadArea.addEventListener('click', () => fileInput.click());

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                handleFileSelection(file);
            });

            // æ‹–æ‹½åŠŸèƒ½
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                handleFileSelection(file);
            });
        }

        // è™•ç†æ–‡ä»¶é¸æ“‡
        function handleFileSelection(file) {
            if (!file) return;

            if (file.type !== 'image/gif') {
                showToast('è«‹é¸æ“‡GIFæ ¼å¼çš„æ–‡ä»¶', 'error');
                return;
            }

            if (file.size > 10 * 1024 * 1024) { // 10MB
                showToast('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…é10MB', 'error');
                return;
            }

            selectedFile = file;
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.innerHTML = `
                <div class="text-6xl text-green-500 mb-4">
                    <i class="fas fa-check-circle"></i>
                </div>
                <p class="text-lg text-green-600 mb-2">å·²é¸æ“‡æ–‡ä»¶ï¼š${file.name}</p>
                <p class="text-sm text-gray-500">å¤§å°ï¼š${(file.size / 1024).toFixed(1)} KB</p>
            `;
            uploadArea.classList.add('border-green-400', 'bg-green-50');
        }

        // ä¸Šå‚³è¡¨å–®æäº¤
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!selectedFile) {
                showToast('è«‹å…ˆé¸æ“‡è¦ä¸Šå‚³çš„GIFæ–‡ä»¶', 'error');
                return;
            }

            const title = document.getElementById('title').value.trim();
            if (!title) {
                showToast('è«‹å¡«å¯«ä½œå“æ¨™é¡Œ', 'error');
                return;
            }

            const uploadBtn = document.getElementById('uploadBtn');
            const originalText = uploadBtn.innerHTML;
            uploadBtn.innerHTML = '<div class="loading mr-2"></div>ä¸Šå‚³ä¸­...';
            uploadBtn.disabled = true;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const workData = {
                        id: 'upload-' + Date.now(),
                        title: title,
                        subtitle: document.getElementById('subtitle').value.trim(),
                        description: document.getElementById('description').value.trim(),
                        category: document.getElementById('category').value,
                        tags: document.getElementById('tags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                        size: `${(selectedFile.size / 1024).toFixed(1)} KB`,
                        image: e.target.result,
                        features: ['é€æ˜èƒŒæ™¯', 'é«˜å“è³ª', 'ç¤¾ç¾¤åª’é«”å„ªåŒ–'],
                        special: false,
                        createdAt: Date.now()
                    };

                    allWorks.push(workData);
                    localStorage.setItem('uploadedWorks', JSON.stringify(allWorks));

                    showToast('ä½œå“ä¸Šå‚³æˆåŠŸï¼', 'success');
                    closeUploadModal();
                    loadUploadedWorks();
                } catch (error) {
                    console.error('ä¸Šå‚³å¤±æ•—:', error);
                    showToast('ä¸Šå‚³å¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
                } finally {
                    uploadBtn.innerHTML = originalText;
                    uploadBtn.disabled = false;
                }
            };
            
            reader.onerror = function() {
                showToast('æ–‡ä»¶è®€å–å¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
                uploadBtn.innerHTML = originalText;
                uploadBtn.disabled = false;
            };
            
            reader.readAsDataURL(selectedFile);
        });

        // ç·¨è¼¯ä½œå“
        function editWork(workId) {
            const work = allWorks.find(w => w.id === workId);
            if (!work) {
                showToast('æ‰¾ä¸åˆ°è¦ç·¨è¼¯çš„ä½œå“', 'error');
                return;
            }

            // å¡«å……ç·¨è¼¯è¡¨å–®
            document.getElementById('editWorkId').value = work.id;
            document.getElementById('editTitle').value = work.title;
            document.getElementById('editSubtitle').value = work.subtitle || '';
            document.getElementById('editDescription').value = work.description || '';
            document.getElementById('editCategory').value = work.category;
            document.getElementById('editTags').value = work.tags.join(', ');
            document.getElementById('editImagePreview').src = work.image;
            document.getElementById('editFileInput').value = '';
            
            document.getElementById('editModal').classList.add('show');
        }

        // é—œé–‰ç·¨è¼¯æ¨¡æ…‹çª—å£
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
        }

        // ç·¨è¼¯è¡¨å–®æäº¤
        document.getElementById('editForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const workId = document.getElementById('editWorkId').value;
            const title = document.getElementById('editTitle').value.trim();
            
            if (!title) {
                showToast('è«‹å¡«å¯«ä½œå“æ¨™é¡Œ', 'error');
                return;
            }

            const editBtn = document.getElementById('editBtn');
            const originalText = editBtn.innerHTML;
            editBtn.innerHTML = '<div class="loading mr-2"></div>ä¿å­˜ä¸­...';
            editBtn.disabled = true;

            try {
                const workIndex = allWorks.findIndex(w => w.id === workId);
                if (workIndex === -1) {
                    showToast('æ‰¾ä¸åˆ°è¦ç·¨è¼¯çš„ä½œå“', 'error');
                    return;
                }

                const updatedWork = {
                    ...allWorks[workIndex],
                    title: title,
                    subtitle: document.getElementById('editSubtitle').value.trim(),
                    description: document.getElementById('editDescription').value.trim(),
                    category: document.getElementById('editCategory').value,
                    tags: document.getElementById('editTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                    updatedAt: Date.now()
                };

                const newFile = document.getElementById('editFileInput').files[0];
                if (newFile && newFile.type === 'image/gif') {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        updatedWork.image = e.target.result;
                        updatedWork.size = `${(newFile.size / 1024).toFixed(1)} KB`;
                        
                        allWorks[workIndex] = updatedWork;
                        localStorage.setItem('uploadedWorks', JSON.stringify(allWorks));
                        
                        showToast('ä½œå“ç·¨è¼¯æˆåŠŸï¼', 'success');
                        closeEditModal();
                        loadUploadedWorks();
                        
                        editBtn.innerHTML = originalText;
                        editBtn.disabled = false;
                    };
                    reader.readAsDataURL(newFile);
                } else {
                    allWorks[workIndex] = updatedWork;
                    localStorage.setItem('uploadedWorks', JSON.stringify(allWorks));
                    
                    showToast('ä½œå“ç·¨è¼¯æˆåŠŸï¼', 'success');
                    closeEditModal();
                    loadUploadedWorks();
                    
                    editBtn.innerHTML = originalText;
                    editBtn.disabled = false;
                }
            } catch (error) {
                console.error('ä¿å­˜ç·¨è¼¯å¤±æ•—:', error);
                showToast('ä¿å­˜å¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
                editBtn.innerHTML = originalText;
                editBtn.disabled = false;
            }
        });

        // ä¸‹è¼‰ä½œå“
        function downloadWork(workId) {
            const work = allWorks.find(w => w.id === workId);
            if (!work) {
                showToast('æ‰¾ä¸åˆ°è¦ä¸‹è¼‰çš„ä½œå“', 'error');
                return;
            }

            try {
                const link = document.createElement('a');
                link.href = work.image;
                link.download = `${work.title}.gif`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showToast('ä¸‹è¼‰é–‹å§‹', 'success');
            } catch (error) {
                console.error('ä¸‹è¼‰å¤±æ•—:', error);
                showToast('ä¸‹è¼‰å¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
            }
        }

        // ç¢ºèªåˆªé™¤
        function confirmDelete(workId) {
            const work = allWorks.find(w => w.id === workId);
            if (!work) return;

            showConfirmModal(
                'ğŸ—‘ï¸',
                'ç¢ºèªåˆªé™¤',
                `æ‚¨ç¢ºå®šè¦åˆªé™¤ä½œå“ã€Œ${work.title}ã€å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ã€‚`,
                () => deleteWork(workId)
            );
        }

        // åˆªé™¤ä½œå“
        function deleteWork(workId) {
            try {
                allWorks = allWorks.filter(w => w.id !== workId);
                localStorage.setItem('uploadedWorks', JSON.stringify(allWorks));
                selectedWorks.delete(workId);
                
                showToast('ä½œå“å·²æˆåŠŸåˆªé™¤', 'success');
                loadUploadedWorks();
            } catch (error) {
                console.error('åˆªé™¤å¤±æ•—:', error);
                showToast('åˆªé™¤å¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
            }
        }

        // é¡¯ç¤ºç¢ºèªæ¨¡æ…‹çª—å£
        function showConfirmModal(icon, title, message, onConfirm) {
            document.getElementById('confirmIcon').textContent = icon;
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmBtn').onclick = () => {
                onConfirm();
                closeConfirmModal();
            };
            document.getElementById('confirmModal').classList.add('show');
        }

        // é—œé–‰ç¢ºèªæ¨¡æ…‹çª—å£
        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('show');
        }

        // åˆ‡æ›æ‰¹é‡æ¨¡å¼
        function toggleBatchMode() {
            batchMode = !batchMode;
            const btn = document.getElementById('batchModeBtn');
            const actions = document.getElementById('batchActions');
            
            if (batchMode) {
                btn.innerHTML = '<i class="fas fa-times mr-2"></i>é€€å‡ºæ‰¹é‡';
                btn.classList.add('bg-red-100', 'text-red-700', 'border-red-300');
                actions.classList.remove('hidden');
            } else {
                btn.innerHTML = '<i class="fas fa-check-square mr-2"></i>æ‰¹é‡æ“ä½œ';
                btn.classList.remove('bg-red-100', 'text-red-700', 'border-red-300');
                actions.classList.add('hidden');
                selectedWorks.clear();
            }
            
            renderWorks();
        }

        // åˆ‡æ›ä½œå“é¸æ“‡
        function toggleWorkSelection(workId) {
            if (selectedWorks.has(workId)) {
                selectedWorks.delete(workId);
            } else {
                selectedWorks.add(workId);
            }
            renderWorks();
        }

        // æ‰¹é‡ä¸‹è¼‰
        function batchDownload() {
            if (selectedWorks.size === 0) {
                showToast('è«‹å…ˆé¸æ“‡è¦ä¸‹è¼‰çš„ä½œå“', 'warning');
                return;
            }

            selectedWorks.forEach(workId => {
                setTimeout(() => downloadWork(workId), 100);
            });
        }

        // æ‰¹é‡åˆªé™¤
        function batchDelete() {
            if (selectedWorks.size === 0) {
                showToast('è«‹å…ˆé¸æ“‡è¦åˆªé™¤çš„ä½œå“', 'warning');
                return;
            }

            showConfirmModal(
                'ğŸ—‘ï¸',
                'æ‰¹é‡åˆªé™¤',
                `æ‚¨ç¢ºå®šè¦åˆªé™¤é¸ä¸­çš„ ${selectedWorks.size} å€‹ä½œå“å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ã€‚`,
                () => {
                    selectedWorks.forEach(workId => {
                        allWorks = allWorks.filter(w => w.id !== workId);
                    });
                    localStorage.setItem('uploadedWorks', JSON.stringify(allWorks));
                    selectedWorks.clear();
                    showToast('æ‰¹é‡åˆªé™¤æˆåŠŸ', 'success');
                    loadUploadedWorks();
                }
            );
        }

        // åŒ¯å‡ºæ•¸æ“š
        function exportData() {
            try {
                const dataStr = JSON.stringify(allWorks, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `å®—æ•™è²¼åœ–é¤¨_å‚™ä»½_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                showToast('æ•¸æ“šåŒ¯å‡ºæˆåŠŸ', 'success');
            } catch (error) {
                console.error('åŒ¯å‡ºå¤±æ•—:', error);
                showToast('åŒ¯å‡ºå¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
            }
        }

        // åŒ¯å…¥æ•¸æ“š
        function importData() {
            document.getElementById('importFileInput').click();
        }

        // è™•ç†åŒ¯å…¥æ–‡ä»¶
        function handleImportFile(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (!Array.isArray(importedData)) {
                        throw new Error('ç„¡æ•ˆçš„æ•¸æ“šæ ¼å¼');
                    }

                    showConfirmModal(
                        'ğŸ“¥',
                        'ç¢ºèªåŒ¯å…¥',
                        `å³å°‡åŒ¯å…¥ ${importedData.length} å€‹ä½œå“ï¼Œé€™å°‡è¦†è“‹ç¾æœ‰æ•¸æ“šã€‚ç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ`,
                        () => {
                            allWorks = importedData;
                            localStorage.setItem('uploadedWorks', JSON.stringify(allWorks));
                            loadUploadedWorks();
                            showToast('æ•¸æ“šåŒ¯å…¥æˆåŠŸ', 'success');
                        }
                    );
                } catch (error) {
                    console.error('åŒ¯å…¥å¤±æ•—:', error);
                    showToast('åŒ¯å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ–‡ä»¶æ ¼å¼', 'error');
                }
            };
            reader.readAsText(file);
        }

        // åˆ‡æ›è¦–åœ–æ¨¡å¼
        function changeView(mode) {
            viewMode = mode;
            document.getElementById('gridViewBtn').classList.toggle('text-amber-600', mode === 'grid');
            document.getElementById('listViewBtn').classList.toggle('text-amber-600', mode === 'list');
            // é€™è£¡å¯ä»¥å¯¦ç¾ç¶²æ ¼è¦–åœ–çš„é‚è¼¯
        }

        // é è¦½åœ–ç‰‡
        function previewImage(src, title) {
            // å¯ä»¥å¯¦ç¾åœ–ç‰‡é è¦½åŠŸèƒ½
            window.open(src, '_blank');
        }

        // éµç›¤å¿«æ·éµ
        function handleKeyboardShortcuts(e) {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'n':
                        e.preventDefault();
                        showUploadModal();
                        break;
                    case 'f':
                        e.preventDefault();
                        document.getElementById('searchInput').focus();
                        break;
                    case 's':
                        e.preventDefault();
                        exportData();
                        break;
                }
            }
            
            if (e.key === 'Escape') {
                closeUploadModal();
                closeEditModal();
                closeConfirmModal();
            }
        }

        // é¡¯ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'} mr-2"></i>
                ${message}
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // é»æ“Šæ¨¡æ…‹çª—å£å¤–éƒ¨é—œé–‰
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // ==================== GitHub æ•´åˆåŠŸèƒ½ ====================

        // è¼‰å…¥GitHubé…ç½®
        function loadGitHubConfig() {
            const saved = localStorage.getItem('githubConfig');
            if (saved) {
                githubConfig = JSON.parse(saved);
                document.getElementById('githubRepo').value = githubConfig.repo || '';
                document.getElementById('githubToken').value = githubConfig.token || '';
                document.getElementById('githubBranch').value = githubConfig.branch || 'main';
                
                if (githubConfig.repo && githubConfig.token) {
                    isGitHubConnected = true;
                }
            }
        }

        // ä¿å­˜GitHubé…ç½®
        function saveGitHubConfig() {
            localStorage.setItem('githubConfig', JSON.stringify(githubConfig));
            updateGitHubStatus();
        }

        // æ›´æ–°GitHubé€£æ¥ç‹€æ…‹
        function updateGitHubStatus() {
            const statusElement = document.getElementById('githubStatus');
            const connectionStatusElement = document.getElementById('connectionStatus');
            
            if (isGitHubConnected) {
                statusElement.className = 'github-status github-connected';
                statusElement.innerHTML = '<i class="fab fa-github mr-1"></i>å·²é€£æ¥';
                
                if (connectionStatusElement) {
                    connectionStatusElement.className = 'github-status github-connected';
                    connectionStatusElement.innerHTML = '<i class="fas fa-check-circle mr-1"></i>å·²é€£æ¥';
                }
                
                const messageElement = document.getElementById('connectionMessage');
                if (messageElement) {
                    messageElement.textContent = `å·²é€£æ¥åˆ° ${githubConfig.repo}`;
                }
            } else {
                statusElement.className = 'github-status github-disconnected';
                statusElement.innerHTML = '<i class="fab fa-github mr-1"></i>æœªé€£æ¥';
                
                if (connectionStatusElement) {
                    connectionStatusElement.className = 'github-status github-disconnected';
                    connectionStatusElement.innerHTML = '<i class="fas fa-times-circle mr-1"></i>æœªé€£æ¥';
                }
            }
        }

        // é¡¯ç¤ºGitHubé…ç½®æ¨¡æ…‹çª—å£
        function showGitHubConfigModal() {
            document.getElementById('githubConfigModal').classList.add('show');
        }

        // é—œé–‰GitHubé…ç½®æ¨¡æ…‹çª—å£
        function closeGitHubConfigModal() {
            document.getElementById('githubConfigModal').classList.remove('show');
        }

        // æ¸¬è©¦GitHubé€£æ¥
        async function testGitHubConnection() {
            const repo = document.getElementById('githubRepo').value.trim();
            const token = document.getElementById('githubToken').value.trim();
            const branch = document.getElementById('githubBranch').value.trim() || 'main';

            if (!repo || !token) {
                showToast('è«‹å¡«å…¥Repositoryå’ŒAccess Token', 'error');
                return;
            }

            const testElement = document.getElementById('connectionTest');
            const statusElement = document.getElementById('testStatus');
            const messageElement = document.getElementById('testMessage');

            testElement.classList.remove('hidden');
            statusElement.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>æ¸¬è©¦ä¸­...';
            statusElement.className = 'text-sm text-blue-600';
            messageElement.textContent = 'æ­£åœ¨é©—è­‰GitHubé€£æ¥...';

            try {
                // æ¸¬è©¦GitHub APIé€£æ¥
                const response = await fetch(`https://api.github.com/repos/${repo}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    const repoData = await response.json();
                    statusElement.innerHTML = '<i class="fas fa-check-circle mr-1"></i>é€£æ¥æˆåŠŸ';
                    statusElement.className = 'text-sm text-green-600';
                    messageElement.textContent = `æˆåŠŸé€£æ¥åˆ° ${repoData.full_name}`;
                    
                    // æ›´æ–°é…ç½®
                    githubConfig = { repo, token, branch };
                    isGitHubConnected = true;
                    
                    showToast('GitHubé€£æ¥æ¸¬è©¦æˆåŠŸï¼', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                statusElement.innerHTML = '<i class="fas fa-times-circle mr-1"></i>é€£æ¥å¤±æ•—';
                statusElement.className = 'text-sm text-red-600';
                messageElement.textContent = `éŒ¯èª¤: ${error.message}`;
                
                showToast('GitHubé€£æ¥æ¸¬è©¦å¤±æ•—', 'error');
            }
        }

        // GitHubé…ç½®è¡¨å–®æäº¤
        document.getElementById('githubConfigForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const repo = document.getElementById('githubRepo').value.trim();
            const token = document.getElementById('githubToken').value.trim();
            const branch = document.getElementById('githubBranch').value.trim() || 'main';

            if (!repo || !token) {
                showToast('è«‹å¡«å…¥æ‰€æœ‰å¿…è¦ä¿¡æ¯', 'error');
                return;
            }

            githubConfig = { repo, token, branch };
            isGitHubConnected = true;
            
            saveGitHubConfig();
            closeGitHubConfigModal();
            
            showToast('GitHubè¨­ç½®å·²ä¿å­˜', 'success');
        });

        // ä¸Šå‚³æ–‡ä»¶åˆ°GitHub
        async function uploadToGitHub(fileName, content, commitMessage) {
            if (!isGitHubConnected) {
                throw new Error('GitHubæœªé€£æ¥ï¼Œè«‹å…ˆé…ç½®GitHubè¨­ç½®');
            }

            const { repo, token, branch } = githubConfig;
            const path = `images/${fileName}`;

            try {
                // æª¢æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨
                let sha = null;
                try {
                    const existingResponse = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (existingResponse.ok) {
                        const existingData = await existingResponse.json();
                        sha = existingData.sha;
                    }
                } catch (e) {
                    // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œç¹¼çºŒä¸Šå‚³
                }

                // ä¸Šå‚³æ–‡ä»¶
                const uploadData = {
                    message: commitMessage,
                    content: content,
                    branch: branch
                };

                if (sha) {
                    uploadData.sha = sha;
                }

                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(uploadData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP ${response.status}`);
                }

                const result = await response.json();
                return result.content.download_url;
            } catch (error) {
                console.error('GitHubä¸Šå‚³éŒ¯èª¤:', error);
                throw error;
            }
        }

        // ä¸Šå‚³ä½œå“æ•¸æ“šåˆ°GitHub
        async function uploadWorksDataToGitHub() {
            if (!isGitHubConnected) {
                return;
            }

            try {
                const worksData = {
                    works: allWorks,
                    lastUpdated: new Date().toISOString()
                };

                const content = btoa(unescape(encodeURIComponent(JSON.stringify(worksData, null, 2))));
                
                await uploadToGitHub('works.json', content, 'Update works data');
                
                showToast('ä½œå“æ•¸æ“šå·²åŒæ­¥åˆ°GitHub', 'success');
            } catch (error) {
                console.error('åŒæ­¥ä½œå“æ•¸æ“šå¤±æ•—:', error);
                showToast('åŒæ­¥ä½œå“æ•¸æ“šå¤±æ•—: ' + error.message, 'error');
            }
        }

        // ä¿®æ”¹åŸæœ‰çš„ä¸Šå‚³å‡½æ•¸ä»¥æ”¯æ´GitHub
        const originalUploadForm = document.getElementById('uploadForm');
        originalUploadForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!isGitHubConnected) {
                showToast('è«‹å…ˆé…ç½®GitHubè¨­ç½®', 'error');
                showGitHubConfigModal();
                return;
            }

            if (!selectedFile) {
                showToast('è«‹é¸æ“‡è¦ä¸Šå‚³çš„æ–‡ä»¶', 'error');
                return;
            }

            const title = document.getElementById('title').value.trim();
            const subtitle = document.getElementById('subtitle').value.trim();
            const description = document.getElementById('description').value.trim();
            const category = document.getElementById('category').value;
            const tags = document.getElementById('tags').value.trim();

            if (!title) {
                showToast('è«‹å¡«å…¥ä½œå“æ¨™é¡Œ', 'error');
                return;
            }

            const uploadBtn = document.getElementById('uploadBtn');
            const originalText = uploadBtn.innerHTML;
            uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ä¸Šå‚³ä¸­...';
            uploadBtn.disabled = true;

            try {
                // è½‰æ›æ–‡ä»¶ç‚ºbase64
                const reader = new FileReader();
                reader.onload = async function(e) {
                    try {
                        const base64Content = e.target.result.split(',')[1];
                        const fileName = `${Date.now()}_${selectedFile.name}`;
                        
                        // ä¸Šå‚³åˆ°GitHub
                        const githubUrl = await uploadToGitHub(
                            fileName, 
                            base64Content, 
                            `Add new sticker: ${title}`
                        );

                        // å‰µå»ºä½œå“å°è±¡
                        const work = {
                            id: Date.now(),
                            title,
                            subtitle,
                            description,
                            category,
                            tags: tags.split(',').map(tag => tag.trim()).filter(tag => tag),
                            gifUrl: githubUrl,
                            webpUrl: null, // å¯ä»¥å¾ŒçºŒæ·»åŠ WebPè½‰æ›
                            fileSize: selectedFile.size,
                            uploadDate: new Date().toISOString(),
                            source: 'github'
                        };

                        // æ·»åŠ åˆ°æœ¬åœ°å­˜å„²
                        allWorks.unshift(work);
                        localStorage.setItem('uploadedWorks', JSON.stringify(allWorks));

                        // åŒæ­¥ä½œå“æ•¸æ“šåˆ°GitHub
                        await uploadWorksDataToGitHub();

                        // æ›´æ–°ç•Œé¢
                        applyFilters();
                        updateStats();
                        closeUploadModal();
                        
                        showToast('ä½œå“å·²æˆåŠŸä¸Šå‚³åˆ°GitHubï¼', 'success');
                        
                        // é‡ç½®è¡¨å–®
                        document.getElementById('uploadForm').reset();
                        selectedFile = null;
                        document.getElementById('formatPreview').classList.add('hidden');
                        
                    } catch (error) {
                        console.error('ä¸Šå‚³å¤±æ•—:', error);
                        showToast('ä¸Šå‚³å¤±æ•—: ' + error.message, 'error');
                    } finally {
                        uploadBtn.innerHTML = originalText;
                        uploadBtn.disabled = false;
                    }
                };
                
                reader.readAsDataURL(selectedFile);
                
            } catch (error) {
                console.error('ä¸Šå‚³å¤±æ•—:', error);
                showToast('ä¸Šå‚³å¤±æ•—: ' + error.message, 'error');
                uploadBtn.innerHTML = originalText;
                uploadBtn.disabled = false;
            }
        });
    </script>
</body>
</html>

